# End Users Authentication and Authorization

## Introduction

Access control in DIAL rests upon the concept of Objects of access (what we protect) and Subjects of access (who we give access to) and Actions (what kind of access is given). Objects refer to entities  such as Models, Applications, Toolsets, Files, Prompts, and Conversations. Subjects are actors who access Objects, trying to create, update, delete, read, or use them.

End-users are Subjects that authenticate in DIAL Core using JWT access tokens to access DIAL Core resources.

> * Refer to [Authentication](/docs/platform/3.core/1.auth-intro.md) to learn more about authentication in DIAL.
> * Refer to [Access Control](/docs/platform/3.core/2.access-control-intro.md) to learn more about access control in DIAL.

## Step 1: Get JWT from IDP

When users log in, DIAL uses JWT to authenticate them. JWT tokens that represent users are issued by identity service providers (IDPs).

> Refer to [Configure IDPs](/docs/tutorials/2.devops/2.auth-and-access-control/2.configure-idps/0.overview.md) to view supported IDPs and learn how to configure them.

## Step 2: Enable Access to Resources

To enable user access to specific resources in DIAL (like applications, toolsets, routes or language models) you need to associate JWT with a specific resource. This is done by mapping specific `claim` values from JWT to `userRoles` parameter of a corresponding deployment in DIAL Core configuration. 

> Refer to [DIAL Core documentation](https://github.com/epam/ai-dial-core/blob/development/docs/dynamic-settings/applications.md) for a comprehensive configuration guidelines.

In the following example, JWT with claim value `operator` has access to `chat-gpt-35-turbo` language model. Using the same pattern, you can define user access to [applications](https://github.com/epam/ai-dial-core/blob/development/docs/dynamic-settings/applications.md), [toolset](https://github.com/epam/ai-dial-core/blob/development/docs/dynamic-settings/toolsets.md) and [routes](https://github.com/epam/ai-dial-core/blob/development/docs/dynamic-settings/routes.md).


```json
"models": {
    "chat-gpt-35-turbo": {
        "userRoles": [
            "operator"
            ]
        }
}
```

## Step 3: Add Limits


**IMPORTANT**: 

* If a user's IDP roles aren't explicitly mentioned in the DIAL configuration, a "default" role is applied. 
* If the "default" role is not defined or has no limits set, access to the resource is **unrestricted**. 


In the `roles` section of the DIAL Core dynamic settings, you can include token usage, cost and also sharing limits for roles. 

> * Refer to [Token Limits and Cost Control](/docs/platform/3.core/8.token-limits-and-cost-control.md) to learn more about these mechanisms.
> * Refer to [DIAL Core](https://github.com/epam/ai-dial-core/blob/development/docs/dynamic-settings/roles.md) to learn how to configure roles.

**Effective role rule**: 

* If a user has a role A and B from the IDP which are not mentioned in the `roles` section, limits from the `default` role apply. 
* If the `default` role is not defined in the `roles` section or does not have limits configured for it - the **access is unlimited**.

#### Token Limit

Token rate limiting controls the volume of tokens processed by AI models within specific timeframes. The system tracks both input and output tokens, enforcing limits across minute, daily, weekly, or monthly intervals. When a limit is reached, additional requests are rejected until the time window refreshes.

Token limits are defined as the number of tokens for the following timeframes: minute, day, week, month.

##### Example

In this example, we define the `user` role with daily token usage limits for the `chat-gpt-35-turbo` model .

```json
"roles": {
    "user": {
        "limits": {
            "chat-gpt-35-turbo": {
                "day": "10000000"
            }
        }
    }
}
```

#### Cost Limit

Cost-based rate limiting addresses financial governance by setting **monetary** consumption limits across all models available to a specific role. Unlike token limits, which vary in financial impact depending on the model used, cost limits directly control actual spending. Both cost and rate limits operate in parallel, with requests needing to satisfy all applicable limits. When rejected, users receive notifications explaining which specific constraint was triggered.

Cost limits are defined in USD for the following timeframes: minute, day, week, month.

##### Example

In this example, we define the `operator` role with daily cost limits for all models and token usage daily limit for the `chat-gpt-35-turbo` model .

```json
"roles": {
    "operator": {
        "limits": {
            "chat-gpt-35-turbo": {
                "day": "10000000",
            }
        },
        "costLimit": {
            "day": 100.00,
        },
    }
}
```

#### Sharing Limits

In DIAL, you can share your private resources with other users or applications. A shared resource becomes available for a recipient(s) in DIAL Chat, DIAL Marketplace and via API. Refer to [Sharing](/docs/platform/7.collaboration-intro.md#sharing) to learn more.

You can configure sharing limits for roles to restrict the maximum number of users who can accept an invitation link for a resource (APPLICATION or FILE) being shared. 

* `invitation_ttl`: TTL of the invitation link. Default: 72 (hrs)
* `max_accepted_users`: The maximum number of users who can accept an invitation link for a resource being shared. The limit is applied to the shared resource. Default: 10 for APPLICATION and UNLIMITED for other resource types.

##### Example

```json
"roles": {
    "user": { // the name of the role
        "share": {
            "APPLICATION": {
                "invitation_ttl": "24",
                "max_accepted_users": "10"
                },
            "FILE": {
                "invitation_ttl": "24",
                "max_accepted_users": "10"
                }
            }
        }
    }
```


