# Roles and Access Control for API Keys

## Introduction

API keys can be used not only for [authentication](/docs/platform/3.core/1.auth-intro.md), but also to manage access to system resources and apply restrictions on such access. This is done via assigning of **roles** to API keys. Roles must be associated with specific system resources such as models and applications.

> Refer to [API Keys](/docs/platform/3.core/2.access-control-intro.md#api-keys) to learn more.

## Step 1: Create API Key

You can define API keys in [DIAL Core dynamic settings](https://github.com/epam/ai-dial-core/blob/development/docs/dynamic-settings/keys.md) in the `keys` section.

> Refer to [Create API Key](/docs/tutorials/2.devops/2.auth-and-access-control/0.programmatic-auth.md#step-1-define-api-keys) to see details.

## Step 2: Assign Roles (Required)

You can define roles in [DIAL Core dynamic settings](https://github.com/epam/ai-dial-core/blob/development/docs/dynamic-settings/roles.md) in the `roles` section.

> Refer to [Assign role(s)](/docs/tutorials/2.devops/2.auth-and-access-control/0.programmatic-auth.md#step-2-assign-roles-required) to see details.

## Step 3: Configure Access and Restrictions

In the `roles` section of the DIAL Core dynamic settings, you can include token usage, cost and also sharing limits for roles. 

**Note**: If limits are not configured the **access is unlimited**.

### Usage Limits 

You can configure token usage and cost limits for roles. 

> * Refer to [Token Limits and Cost Control](/docs/platform/3.core/8.token-limits-and-cost-control.md) to learn more about these mechanisms.
> * Refer to [DIAL Core](https://github.com/epam/ai-dial-core/blob/development/docs/dynamic-settings/roles.md) to learn how to configure roles.

#### Token Limit

Token rate limiting controls the volume of tokens processed by AI models within specific timeframes. The system tracks both input and output tokens, enforcing limits across minute, daily, weekly, or monthly intervals. When a limit is reached, additional requests are rejected until the time window refreshes.

Token limits are defined as the number of tokens for the following timeframes: minute, day, week, month.

##### Example

In this example, we define the `basic` role with daily token usage limits for the `chat-gpt-35-turbo` model .

```json
"roles": {
    "user": {
        "limits": {
            "chat-gpt-35-turbo": {
                "day": "10000000"
            }
        }
    }
}
```

#### Cost Limit

Cost-based rate limiting addresses financial governance by setting **monetary** consumption limits across all models available to a specific role. Unlike token limits, which vary in financial impact depending on the model used, cost limits directly control actual spending. Both cost and rate limits operate in parallel, with requests needing to satisfy all applicable limits. When rejected, users receive notifications explaining which specific constraint was triggered.

Cost limits are defined in USD for the following timeframes: minute, day, week, month.

##### Example

In this example, we define the `operator` role with daily cost limits for all models and token usage daily limits for the `chat-gpt-35-turbo` model .

```json
"roles": {
    "operator": {
        "limits": {
            "chat-gpt-35-turbo": {
                "day": "10000000",
            }
        },
        "costLimit": {
            "day": 100.00,
        },
    }
}
```

### Sharing Limits

In DIAL, you can share your private resources with other users or applications. A shared resource becomes available for a recipient(s) in DIAL Chat, DIAL Marketplace and via API. Refer to [Sharing](/docs/platform/7.collaboration-intro.md#sharing) to learn more.

You can configure sharing limits for roles to restrict the maximum number of users who can accept an invitation link for a resource (APPLICATION or FILE) being shared. 

* `invitation_ttl`: TTL of the invitation link. Default: 72 (hrs)
* `max_accepted_users`: The maximum number of users who can accept an invitation link for a resource being shared. The limit is applied to the shared resource. Default: 10 for APPLICATION and UNLIMITED for other resource types.

##### Example

```json
"roles": {
    "basic": { // the name of the role
        "share": {
            "APPLICATION": {
                "invitation_ttl": "24",
                "max_accepted_users": "10"
                },
            "FILE": {
                "invitation_ttl": "24",
                "max_accepted_users": "10"
                }
            }
        }
    }
```

### Example

In the following example, we define the `basic` role with token usage and cost limits for the `chat-gpt-35-turbo` model and sharing limits for applications and files. 

> Refer to [dynamic settings](https://github.com/epam/ai-dial-core/blob/development/docs/dynamic-settings/roles.md) to see other configuration options for roles.


```json
//Example extract from aidial.config.json
"keys": {
    "proxyKey1": { //API key
        "project": "Project1",
        "role": "basic" // the name of the role
    }
},
"roles": {
    "basic": {
        "limits": {
            "chat-gpt-35-turbo": {
                "minute": "100000", //number of tokens per minute
                "day": "10000000",
                "week": "10000000",
                "month": "10000000"
            }
        },
        "costLimit": {
            "minute": 10.00, //cost per minute in USD
            "day": 100.00,
            "week": 500.00,
            "month": 2000.00
        },
        "share": {
            "APPLICATION": {
                "invitation_ttl": "24",
                "max_accepted_users": "10"
            },
            "FILE": {
                "invitation_ttl": "24",
                "max_accepted_users": "10"
            }
        }
    }
}
```