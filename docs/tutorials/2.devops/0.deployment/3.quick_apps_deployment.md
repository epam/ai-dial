# Quick Apps Installation Instructions

## Introduction

Install the Quick Apps component to be able to use Quick Apps in your deployment of DIAL. Follow this guide to do this.

##### Prerequisites

Ensure that you have the necessary permissions to deploy and configure Helm charts and services within the Kubernetes cluster.

## Step 1: Update Components

Make sure the following components are updated to the specified versions:

* [DIAL Core](https://github.com/epam/ai-dial-core) to version 0.28.0 or higher.
* [DIAL Chat](https://github.com/epam/ai-dial-chat) to version 0.29.0.

## Step 2: Deploy Quick Apps with Helm

Run the following Helm command to deploy Quick Apps:

```bash
helm upgrade --install dial-quickapps dial/dial-extension -f ./values.yaml -n dial
```

##### Example of a values.yaml file

```yaml
# This section is provided as an example. Please use the actual image.
image:
  pullPolicy: Always
  registry: registry.deltixhub.com
  repository: ai/dial/application/quickapps
  tag: development
  pullSecrets:
    - dial-dev-registry

podAnnotations:
  autorestart: '{{ dateInZone "2006-01-02 15:04:05Z" (now) "UTC" }}'

  fullnameOverride: quickapps

ingress:
  enabled: false

serviceAccount:
  create: true

env:
  DIAL_URL: "http://dial-core.dial.svc.cluster.local"
  API_VERSION: "2023-03-15-preview"
# API_VERSION sets a unified protocol version used to call models and other apps from quick app executor
# You can omit API_VERSION than default value "2023-03-15-preview" will be applied
# You also can set RAG_DEPLOYMENT_NAME if you want to modify the "default" RAG to be used ("dial-rag" if not set)
```

## Step 3: Configure DIAL Core

After deploying Quick Apps, configure DIAL Core to use the Quick Apps component. To do this: 

1. Add the [Quick Apps application type JSON schema](#quick-apps-schema) to the DIAL Core configuration.
2. Update `"dial:applicationTypeCompletionEndpoint"` and `"dial:applicationTypeConfigurationEndpoint"` with the Quick Apps service endpoints created in [Step 2](#step-2-deploy-quick-apps-with-helm).

* If `"dial:appendApplicationPropertiesHeader": true`, DIAL Core will append the Quick Apps configuration to the [chat completion request](https://dialx.ai/dial_api#operation/sendChatCompletionRequest) headers. 
* If `"dial:appendApplicationPropertiesHeader": false`, Quick Apps service will request the configuration from DIAL Core with an additional request. This may be the preferred option if the configuration is very large to append to a request header.


## Step 4: DIAL Chat Environment Variables

1. Specify the following environment variables for DIAL Chat:

    ```yaml
        # The host URL for Quick Apps Completions URLs. Can lead to public and private resources
        QUICK_APPS_HOST: "http://quickapps.dial.svc.cluster.local" 
        # applicationTypeSchemaId value for QuickApp application type
        QUICK_APPS_SCHEMA_ID: "https://mydial.epam.com/custom_application_schemas/quickapps"
        # A model that will be used in Quick Apps
        QUICK_APPS_MODEL: "gpt-4o-2024-05-13"
    ```

2. Add `quick-apps` to `ENABLED_FEATURES`:

    ```yaml
        ENABLED_FEATURES: "...,quick-apps"
    ```

## Step 5: DIAL Core Environment Variables

Set the following environment variable for DIAL Core to include custom applications:

```yaml
    aidial.applications.includeCustomApps: "true"
```

## Annex

##### Quick Apps Schema

```json
{
  "applicationTypeSchemas": [
    {
      "$schema": "https://dial.epam.com/application_type_schemas/schema#",
      "$id": "https://mydial.epam.com/custom_application_schemas/quickapps",
      "dial:applicationTypeDisplayName": "Quick app",
      "dial:applicationTypeCompletionEndpoint": "http://quickapps.dial-development.svc.cluster.local/openai/deployments/quick_apps/chat/completions",
      "dial:applicationTypeConfigurationEndpoint": "http://quickapps.dial-development.svc.cluster.local/openai/deployments/quick_apps/configuration",
      "dial:appendApplicationPropertiesHeader": true,
      "$defs": {
        "ToolEndpointInfo": {
          "properties": {
            "name": {
              "title": "Name",
              "type": "string"
            },
            "method_url": {
              "title": "Method Url",
              "type": "string"
            },
            "method_type": {
              "$ref": "#/$defs/ToolEndpointInfoMethodType"
            },
            "description": {
              "title": "Description",
              "type": "string"
            },
            "parameters": {
              "items": {
                "$ref": "#/$defs/ToolEndpointParameterInfo"
              },
              "title": "Parameters",
              "type": "array"
            }
          },
          "required": ["name", "method_url", "method_type", "description", "parameters"],
          "title": "ToolEndpointInfo",
          "type": "object"
        },
        "ToolEndpointInfoMethodType": {
          "enum": ["get", "post", "put", "delete"],
          "title": "ToolEndpointInfoMethodType",
          "type": "string"
        },
        "ToolEndpointParameterInfo": {
          "properties": {
            "name": {
              "title": "Name",
              "type": "string"
            },
            "description": {
              "title": "Description",
              "type": "string"
            },
            "url_param": {
              "default": false,
              "title": "Url Param",
              "type": "boolean"
            },
            "constant_value": {
              "default": null,
              "title": "Constant Value"
            },
            "parameter_type": {
              "$ref": "#/$defs/ToolEndpointParameterTypeInfo"
            },
            "item_parameter_type": {
              "anyOf": [
                {
                  "$ref": "#/$defs/ToolEndpointParameterTypeInfo"
                },
                {
                  "type": "null"
                }
              ],
              "default": null
            },
            "item_descriptor": {
              "anyOf": [
                {
                  "type": "string"
                },
                {
                  "type": "null"
                }
              ],
              "default": null,
              "title": "Item Descriptor"
            }
          },
          "required": ["name", "description", "parameter_type"],
          "title": "ToolEndpointParameterInfo",
          "type": "object"
        },
        "ToolEndpointParameterTypeInfo": {
          "enum": ["string", "number", "integer", "object", "array", "boolean"],
          "title": "ToolEndpointParameterTypeInfo",
          "type": "string"
        },
        "WebApiToolsetInfo": {
          "properties": {
            "tool_endpoints": {
              "items": {
                "$ref": "#/$defs/ToolEndpointInfo"
              },
              "title": "Tool Endpoints",
              "type": "array"
            },
            "auth_info": {
              "anyOf": [
                {
                  "discriminator": {
                    "mapping": {
                      "apikey": "#/$defs/WebApiToolsetKeyAuthInfo",
                      "obo": "#/$defs/WebApiToolsetOBOAuthInfo"
                    },
                    "propertyName": "auth_type"
                  },
                  "oneOf": [
                    {
                      "$ref": "#/$defs/WebApiToolsetOBOAuthInfo"
                    },
                    {
                      "$ref": "#/$defs/WebApiToolsetKeyAuthInfo"
                    }
                  ]
                },
                {
                  "type": "null"
                }
              ],
              "title": "Auth Info"
            }
          },
          "required": ["tool_endpoints", "auth_info"],
          "title": "WebApiToolsetInfo",
          "type": "object"
        },
        "WebApiToolsetKeyAuthInfo": {
          "properties": {
            "auth_type": {
              "const": "apikey",
              "enum": ["apikey"],
              "title": "Auth Type",
              "type": "string"
            },
            "api_key": {
              "format": "password",
              "title": "Api Key",
              "type": "string",
              "writeOnly": true
            },
            "url_param": {
              "default": false,
              "title": "Url Param",
              "type": "boolean"
            }
          },
          "required": ["auth_type", "api_key"],
          "title": "WebApiToolsetKeyAuthInfo",
          "type": "object"
        },
        "WebApiToolsetOBOAuthInfo": {
          "properties": {
            "auth_type": {
              "const": "obo",
              "enum": ["obo"],
              "title": "Auth Type",
              "type": "string"
            },
            "tenant": {
              "title": "Tenant",
              "type": "string"
            },
            "grant_type": {
              "title": "Grant Type",
              "type": "string"
            },
            "client_id": {
              "title": "Client Id",
              "type": "string"
            },
            "client_secret": {
              "format": "password",
              "title": "Client Secret",
              "type": "string",
              "writeOnly": true
            },
            "scope": {
              "title": "Scope",
              "type": "string"
            },
            "assertion": {
              "title": "Assertion",
              "type": "string"
            }
          },
          "required": [
            "auth_type",
            "tenant",
            "grant_type",
            "client_id",
            "client_secret",
            "scope",
            "assertion"
          ],
          "title": "WebApiToolsetOBOAuthInfo",
          "type": "object"
        }
      },
      "properties": {
        "temperature": {
          "title": "Temperature",
          "type": "number",
          "dial:meta": {
            "dial:propertyKind": "server",
            "dial:propertyOrder": 1
          }
        },
        "instructions": {
          "title": "Instructions",
          "type": "string",
          "dial:meta": {
            "dial:propertyKind": "server",
            "dial:propertyOrder": 2
          }
        },
        "model": {
          "title": "Model",
          "type": "string",
          "dial:meta": {
            "dial:propertyKind": "server",
            "dial:propertyOrder": 3
          }
        },
        "web_api_toolset": {
          "items": {
            "$ref": "#/$defs/WebApiToolsetInfo"
          },
          "title": "Web Api Toolset",
          "type": "array",
          "dial:meta": {
            "dial:propertyKind": "server",
            "dial:propertyOrder": 4
          }
        },
        "document_relative_url": {
          "oneOf": [
            {
              "type": "string",
              "format": "dial-file-encoded",
              "dial:file": true
            },
            {
              "type": "array",
              "items": {
                "type": "string",
                "dial:file": true,
                "format": "dial-file-encoded"
              }
            }
          ],
          "title": "Documents or document to query with RAG",
          "dial:meta": {
            "dial:propertyKind": "server",
            "dial:propertyOrder": 5
          }
        },
        "attachments_in_stage": {
          "type": "boolean",
          "title": "Show attachments in stages",
          "dial:meta": {
            "dial:propertyKind": "server",
            "dial:propertyOrder": 6
          }
        },
        "starters": {
          "items": {
            "type": "string"
          },
          "title": "Starter buttons",
          "type": "array",
          "dial:meta": {
            "dial:propertyKind": "server",
            "dial:propertyOrder": 7
          }
        },
        "applications_as_tools": {
          "items": {
            "type": "string"
          },
          "type": "array",
          "dial:meta": {
            "dial:propertyKind": "server",
            "dial:propertyOrder": 8
          }
        }
      },
      "required": ["temperature", "instructions", "model", "web_api_toolset"]
    }
  ]
}
```