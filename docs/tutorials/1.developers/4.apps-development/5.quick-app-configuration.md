# Quick App Configuration Guide

## Introduction

Quick app is one of the application types in DIAL. Refer to [Application Types](/docs/platform/0.architecture-and-concepts/4.agentic-platform.md#application-types) to learn more.

Quick apps are conceptually similar to OpenAI's GPT. Quick apps do not contain any programming code (they can include a toolset, a description and instruction to the language model, attachments with documents) and enable you to rapidly build an application right within the DIAL UI, use it, and share it with others. For example, you can create an app with a toolset allowing it to call an external API to get a real-time weather forecast for a specific location. Another example is a RAG-like application that will generate responses based on the provided sources.

> Watch a [Demo Video](/docs/video%20demos/2.Applications/5.quick-apps.md) with an introduction to Quick Apps.

Quick app application type is schema-rich - the structure of custom applications of this type is defined by the schema with ID `https://mydial.epam.com/custom_application_schemas/quickapps`. Refer to [Schema-rich applications](/docs/tutorials/1.developers/4.apps-development/3.enable-app.md#schema-rich-applications) to learn more.

This document explains how to configure QuickApps in the DIAL ecosystem. 

> Refer to [Enable App](/docs/tutorials/1.developers/4.apps-development/3.enable-app.md) to learn how to enable Quick apps that you create in DIAL and make them available for other users.

## Configuration

The structure of Quick app applications is defined by the schema with ID `https://mydial.epam.com/custom_application_schemas/quickapps`. This schema conforms to the [meta schema](https://github.com/epam/ai-dial-core/blob/development/config/src/main/resources/custom-application-schemas/schema). Further, we will describe configuration parameters available in Quick apps schema.

## Main Parameters


| Field          | Type   | Required | Description  | Example       |
|----------------|:--------:|:----------:|-------------------|--------|
| `temperature`  | number | Yes      | Controls randomness in responses (0.0-1.0). Lower values make responses more deterministic, higher values make them more creative. | `0.8`|
| `instructions` | string | Yes      | System prompt that guides the model's behavior.| `"You are a weather assistant. Help users understand weather conditions and what to wear."` |
| `model`        | string | Yes      | The language model ID to use by the application. Refer to [Supported Models](/docs/platform/2.supported-models.md).                                                                                   | `"gpt-4o-2024-05-13"`                                                                       |

## RAG Integration

To use RAG with your Quick Apps as a tool, provide the `query_document` parameter with the `description`: "Ask RAG a question about the
documents assuming it will have access to the conversation history." 

**Note**: When writing instructions for applications using RAG, explicitly mention to query the document first before answering questions.

Follow these application instructions tips for optimal results:

1. Direct the AI to use the RAG tool to retrieve relevant information.
2. Specify to use only the information found in the documents.
3. Provide a fallback response for questions not covered by the documents.

Example:

```
You should help explore the document containing the Copilot Deck. You must query the document first to do that. You should answer using only the information in the document. Answer "I don't know" if there are any other questions.
```

This approach ensures the AI properly leverages the RAG capabilities and produces responses grounded in the provided
documents.

| Field| Type| Required |Description| Example|
|------|-----|:----------:|--|--|
| `document_relative_url` | string or array of strings | No | Path(s) to document(s) that the application can use for RAG (Retrieval Augmented Generation). Each path must be a valid file reference in DIAL. | `"files/DpZGXdhaFYCWNadE2Ln/GPT Deck text.docx"` |


## Custom Buttons

You can enhance user interactions in your application by adding custom buttons for specific actions. To learn how to implement custom buttons, check out [Custom Buttons in Apps](/docs/tutorials/1.developers/4.apps-development/1.custom-buttons.md).

This is how you can configure custom buttons on the example of a starter button:


| Field   | Type| Required | Description| Example |
|------------|------------------|:----------:|--------------------|-------------------------|
| `starters` | array of strings | No       | Suggested starting prompts shown to users in the UI. | `["What to wear in London", "What is the weather in Paris"]` |

## Tools

Use tools to extend the functionality of your Quick App. You can use *internal tools* (other deployed in DIAL applications or models) and *external tools* (external services and web APIs).

### Apps & Models

Your Quick app can be configured to interact with other applications or models deployed in DIAL.
Provide `applications_as_tools` field in the QuickApp schema to enable this. This field can reference
specific applications by their IDs or use [ConditionGroup](#conditiongroup) objects to dynamically match applications based on properties
like `id`, `display_name`, etc.


| Field                   | Type   | Required | Description    | Example   |
|-------------------------|--------|:----------:|---------------|--------|
| `applications_as_tools` | array of `ConditionGroup` or strings | No       | References to other applications that can be used as tools by this application. Can be direct application IDs or condition groups to match applications. | `["copilot_deck_app"]` or conditions to match applications with specific patterns |

##### ConditionGroup

The `applications_as_tools` field can accept either direct application IDs as strings or `ConditionGroup` objects that
define matching criteria for applications. 

##### Properties that can be matched

You can match applications based on these properties:

- `id` - Application identifier
- `display_name` - Display name of the application
- `description` - Application description
- `application` - whether deployment is an application or a model

##### Condition types

`ConditionGroup` supports the following condition types:

|Condition Type|Description|Required Fields|Example|
|:-------------|:----------|:------------------|------------------|
|`eq`|Matches exact values for a property.|`property_name`, `const`|`{"condition_type": "eq", "property_name": "display_name", "const": "RAG Assistant"}`|
|`match`       |Pattern matching using regex.|`property_name`, `expression`|`{"condition_type": "match", "property_name": "id", "expression": ".*rag.*"}`|


Here's how to use `ConditionGroups`:

```json
{
  "applications_as_tools": [
    "direct_application_id",
    {
      "conditions": [
        {
          "condition_type": "match",
          "property_name": "id",
          "expression": ".*rag.*"
        },
        {
          "condition_type": "eq",
          "property_name": "display_name",
          "const": "Specific App Name"
        }
      ]
    }
  ]
}
```



### External Tools

Your application can use external tools that can be invoked outside of the QuickApp application. Include the `client_toolset` field in the QuickApp schema to enable this. 

Unlike [internal tools](#apps--models), when the LLM decides to call a `client_toolset` tool, the processing chain is stopped, and QuickApp responds with a `tool_call` message. 
The response also includes additional metadata (`intermediate_steps_to_restore`) that needs to be sent back to QuickApp along with the `tool_call` result once the tool execution is completed to ensure proper flow restoration. 

##### Example

```json
{
    "custom_content": {
        "state": {
            "intermediate_steps_to_restore": "[[{\"lc\": 1, \"type\": \"constructor\", \"id\": [\"langchain\", \"schema\", \"agent\", \"ToolAgentAction\"], \"kwargs\": {\"tool\": \"geo_code\", ...}}]]"
        }
    }
}
```


The `client_toolset` tools are intended **purely for external calls** and require communication outside the QuickApp environment.

| Field          | Type                    | Required | Description    | Example                      |
|:---------------|:------------------------|:---------:|:-----------------|:-----------------------------|
| `client_toolset` | array of ClientToolInfo | No       | A collection of external client tools that can be called outside the QuickApp application. | See [Structure](#structure) for details. |

##### Structure

Each tool within the `client_toolset` is designed to serve a specific functionality, and it is represented by the `name`, `description`, and its `parameters`.
These tools can be invoked by providing the required parameters as input.
When a tool is invoked, QuickApp expects the result to include the metadata for intermediate steps alongside the computed result.

| Field       | Type                            | Required | Description                                            |
|:------------|:--------------------------------|:---------|:-------------------------------------------------------|
| `name`        | string                          | Yes      | Name of the tool accessible for LLM.                    |
| `description` | string                          | Yes      | Description of the external tool accessible for LLM.    |
| `parameters`  | array of ClientToolsetParamInfo | Yes      | List of parameters required for the external tool call. Refer to [Parameters](#parameters). |

##### Parameters

The `parameters` field in the `client_toolset` defines the input required by the external tool. 
Each parameter within the tool configuration specifies its name, type, and a brief description. 
This ensures that the tool interface is well-documented and easy to utilize.

| Field          | Type   | Required | Description                                                  | Example             |
|:---------------|:-------|:---------:|:-------------------------------------------------------------|:--------------------|
| `name`           | string | Yes      | Parameter's name used when invoking the tool.                   | `"param"`             |
| `description`    | string | Yes      | User-friendly description of the parameter used by the tool. | `"param to multiply"` |
| `parameter_type` | enum   | Yes      | Data type of the parameter (string, number, integer, etc.).   | `"integer"`           |

##### Example

```json
[
  {
    "name": "multiply_tool",
    "description": "multiply_tool description",
    "parameters": [
      {
        "name": "param",
        "description": "param to multiply",
        "parameter_type": "integer"
      }
    ]
  }
]
```

### Web API

Your Quick app can use tools to call different web APIs. Include the `web_api_toolset` field in the QuickApp schema to enable this.

| Field             | Type                       | Required | Description                                                                  | Example                      |
|-------------------|----------------------------|:----------:|------------------------------------------------------------------------------|------------------------------|
| `web_api_toolset` | array of `WebApiToolsetInfo` | No       | Collection of API tools that the application can use to fetch external data. | See [Structure](#structure-1) for details. |

##### Structure

One `WebApiToolsetInfo` item from the `web_api_toolset` array corresponds to one specific web API and contains:

* allowed endpoints (method + url + parameters) (`ToolEndpointInfo`)
* authorization details (auth_info) for the website

Each `WebApiToolsetInfo` object has the following structure:

| Field            | Type                                                         | Required | Description                                    |
|------------------|--------------------------------------------------------------|:----------:|------------------------------------------------|
| `tool_endpoints` | array of `ToolEndpointInfo`                                    | Yes      | Collection of endpoints the tool can call. Refer to [Tool Endpoints Definition](#tool-endpoints-definition)for details.    |
| `auth_info`      | `WebApiToolsetKeyAuthInfo` or null | Yes      | Authentication configuration for the endpoints. Refer to [API Key Authentication](#api-key-authentication) for details. |

##### Tool Endpoints Definition

The `tool_endpoints` field contains an array of web API endpoints, where each endpoint represents a single web API
method (e.g., GET /cart) along with its list of parameters. The primary goal is to convert each method into a tool that
the LLM can use.

Each `ToolEndpointInfo` contains:

| Field         | Type       | Required | Description | Example |
|---------------|-----------|:----------:|---------------|-------------|
| `name`        | string                             | Yes      | Name of the tool function accessible for LLM.         | `"geo_code"`                                                                      |
| `method_url`  | string                             | Yes      | URL of the API endpoint.                              | `"https://geocode.maps.co/search"`                                                |
| `method_type` | string enum                        | Yes      | HTTP method (get, post, put, delete).                 | `"get"`                                                                           |
| `description` | string                             | Yes      | Description of what the tool accessible for LLM does.  | `"To get geo information (lat, lon, etc.) for the address, or city, or location"` |
| `parameters`  | array of `ToolEndpointParameterInfo` | Yes      | Parameters for the API call.                         | Refer to [Parameters Definition](#parameters-definition) fore details. |

##### Parameters Definition

The primary purpose of describing parameters is not only to provide type hints and descriptions for the LLM but also to
distinguish web API endpoint parameters that should have constant values and must not be exposed to the model.

Each `ToolEndpointParameterInfo` contains:

| Field                 | Type    | Default  |Required| Description                                                                 | 
|-----------------------|---------|:----------:|:--:|-----------------------------------------------------------------------------|
| `name`                | string  |  |Yes |The name of the parameter that the LLM can use to invoke the tool.          |
| `description`         | string  |  | Yes|User-friendly explanation of the parameter accessible for the LLM. |
| `parameter_type`      | enum    |  |Yes |Data type (`string`, `number`, `integer`, `boolean`, `object`, `array`) of the parameter.    |
| `url_param`           | boolean | `false`  | |If `true`, the parameter will be sent as query param instead of request body.   |
| `constant_value`      | any     | `null`   | |Fixed value that will be used (LLM will not be aware of this parameter at all). |
| `item_parameter_type` | enum    | `null`   | |Specifies the data type of array items. **For arrays only**.              |
| `item_descriptor`     | string  | `null`   | |Description of individual array items. **For arrays only**.                      |

##### Example

```json
[
  {
    "name": "latitude",
    "description": "latitude of location you want to get current weather",
    "parameter_type": "number",
    "url_param": true
  },
  {
    "name": "q",
    "description": "location you want to get geo information about",
    "parameter_type": "string",
    "url_param": true
  },
  {
    "name": "format",
    "description": "format of output data",
    "parameter_type": "string",
    "url_param": true,
    "constant_value": "csv"
  }
]
```

##### API Key Authentication

Provide these parameters to configure authentication for the web API endpoints.

| Field       | Type              | Required | Description | Example                             |
|-------------|-------------------|:----------:|---------------|-------------------------------------|
| `auth_type` | string            | Yes      | Set to  `"apikey"`.                                                            | `"apikey"`                          |
| `api_key`   | string (password) | Yes      | API key value.                                                               | `"66ffe77d0c491772030151dzacba530"` |
| `url_param` | boolean           | No       | Indicates if the key should be sent as a URL parameter. If set to `false`, it will be sent in the request header. Defaults to `false`. | `true`                              |

## Complete Example

```json
{
  "displayName": "Weather Quick App Demo",
  "description": "You can ask about the weather or clothes to wear",
  "applicationTypeSchemaId": "https://mydial.epam.com/custom_application_schemas/quickapps",
  "applicationProperties": {
    "temperature": 0.8,
    "instructions": "You are a weather assistant. Help users understand weather conditions and what to wear.",
    "model": "gpt-4o-2024-05-13",
    "starters": [
      "What to wear in London",
      "What is the weather in Paris"
    ],
    "applications_as_tools": [
      {
        "conditions": [
          {
            "condition_type": "match",
            "property_name": "id",
            "expression": ".*rag.*"
          }
        ]
      },
      "copilot_deck_app"
    ], 
    "client_toolset": [
      {
        "name": "multiply_tool",
        "description": "multiply_tool description",
        "parameters": [
          {
            "name": "param",
            "description": "param to multiply",
            "parameter_type": "integer"
          }
        ]
      }
    ],
    "web_api_toolset": [
      {
        "tool_endpoints": [
          {
            "name": "geo_code",
            "method_url": "https://geocode.maps.co/search",
            "method_type": "get",
            "description": "To get geo information (lat, lon, etc.) for the address, or city, or location",
            "parameters": [
              {
                "name": "q",
                "description": "location you want to get geo information about",
                "parameter_type": "string",
                "url_param": true
              }
            ]
          }
        ],
        "auth_info": {
          "auth_type": "apikey",
          "api_key": "66ffe77d0c491772030151dzacba530",
          "url_param": true
        }
      },
      {
        "tool_endpoints": [
          {
            "name": "weather",
            "method_url": "https://api.open-meteo.com/v1/forecast",
            "method_type": "get",
            "description": "To get current weather for geo coordinates (lat, lon)",
            "parameters": [
              {
                "name": "latitude",
                "description": "latitude of location you want to get current weather",
                "parameter_type": "number",
                "url_param": true
              },
              {
                "name": "longitude",
                "description": "longitude of location you want to get current weather",
                "parameter_type": "number",
                "url_param": true
              },
              {
                "name": "current",
                "description": "values you want to get info about in tearms of current weather",
                "parameter_type": "string",
                "url_param": true,
                "constant_value": "temperature_2m"
              },
              {
                "name": "format",
                "description": "format of output data",
                "parameter_type": "string",
                "url_param": true,
                "constant_value": "csv"
              }
            ]
          }
        ],
        "auth_info": null
      }
    ]
  }
}
```
