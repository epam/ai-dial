# Access Control

Access Control in DIAL means managing access to system resources (objects) for roles (subjects).

## About Resources

Resources in DIAL are applications, models, toolsets, files, conversations and prompts. 

> * Refer to [Applications](/docs/platform/3.core/7.apps.md) to learn about apps in DIAL.
> * Refer to [Models](/docs/platform/2.supported-models.md) to learn about the supported language models in DIAL.
> * Refer to [DIAL Core](/docs/platform/3.core/7.apps.md) to learn how to register toolsets in DIAL Core.

Resources are stored in a dedicated BLOB storage and can be accessed through the [DIAL Core API](https://dialx.ai/dial_api).

##### Storage Folder Structure

**TBD**

|Folder|Description|Ownership|
|---|---|---|
|public|Contains sub-folders: files, conversations, prompts.|Any user who has permissions.|
|privates|Contains sub-folders: files, conversations, prompts.|Any user who has permissions.|

## About Roles

Roles in DIAL provide a flexible and granular mechanism for managing access, controlling resource utilization, and customizing application behavior.

* **Resource Access Control:** Roles determine who can use specific resources. For instance, you can grant users with a specific role access to the "chat-gpt-35-turbo" model.
* **Usage Limits:** Roles can enforce limits on resource usage, preventing overuse and abuse. You can set daily, weekly, or monthly token limits for specific roles using a model.
* **Custom Application Logic:** Developers can leverage roles within their applications to create custom behaviors. By accessing role information from user tokens, applications can tailor responses or restrict access to internal assets.
* **System Feature Access:** Roles manage access to system-level features, ensuring only authorized users have access. For example, only users with the "admin" role might be able to access the administration console.
* **Sharing limits**: For a role, you can configure the maximum number of users who can accept a shared resource and the TTL of the invitation link.

> Refer to [DIAL Core repository](https://github.com/epam/ai-dial-core?tab=readme-ov-file#dynamic-settings) to see how to add roles to the DIAL Core configuration.

### DIAL Admin Role

|System Admin|Application Admin|
|---|---|
|- System admin(s) can be defined in DIAL Core static settings in the `access.admin.rules`.<br />- Controls global settings for DIAL.<br />- Has READ and WRITE access to all system resources (applications, models, toolsets, files, conversations and prompts.).<br />- Can view, approve and reject publication requests from DIAL users.<br />- Has access to all DIAL Core API endpoints.<br />- Cannot access Application settings, can only disable/delete Application, or create a new Application (and become its Admin).|- Initial Application Admin is its creator.<br />- Controls Application's settings, such as: Routes, Roles, Prompts, Interceptors, Folders/Files etc.<br />- Can define "logical roles" for Application authorization logic and map them to the real Groups (app can later request whether user belongs to the role or not).<br />- Can control App Settings in DIAL. <br />- Can access DIAL from App's behalf - app's folder, prompts etc.<br />- Can also (optionally) assign a group to this role.|

### Access Matrix

**TBD** - need to decide on groups that do not represent resources (e.g. routes)

This table outlines access to different system resources for standard roles.

||Admin<br />(JWT token, API Key)|No Role (default)<br />(JWT token)|Other Roles<br />(JWT token, API Key)|
|---|:---:|:---:|:---:|
|**All Configs**<br />(DIAL + Apps)|||
|Read Config|:white_check_mark:|:x:|:x:|
|Write Config|:white_check_mark:|:x:|:x:|
|Export Config|:white_check_mark:|:x:|:x:|
|Read / Export Config.Secrets|:x:|:x:|:x:|
|**Routes**<br />(Access via dynamic config)|||
|Routes<br />(add, read, edit)|:white_check_mark:<br />Global Routes|:x:|:x:|
|Make a call to a Route|:x:|:x:|:white_check_mark:<br />Global user roles or API key|
|**Keys**<br />(Access via dynamic config)|||
|Read Keys Definitions<br />(without secrets)|:white_check_mark:|:x:|:x:|
|Create Keys|:white_check_mark:|:x:|:x:|
|**Files**<br />(Public, own (personal), app's files, app user's files - access via /files API)|||
|Add (upload) files|:white_check_mark:<br />(own personal files, other users' personal files, app's files, own app user's files, other users' app user's files)|:white_check_mark:<br />own files (including app user's files)|:white_check_mark:<br />own files (including app user's files)|
|List files|:white_check_mark:<br />(public files, own files, shared files, other users' files, app's files, own app user's files, other users' app user's files)|:white_check_mark:<br />(public files (according to rules), own files, shared files)|:white_check_mark:<br />(public files (according to rules), own files, shared files)|
|Get files|:white_check_mark:<br />(public files, own files, shared files, other users' files, app's files, own app user's files, other users' app user's files)|:white_check_mark:<br />(public files (according to rules), own files, shared files)|:white_check_mark:<br />(public files (according to rules), own files, shared files)|
|Delete files|:white_check_mark:<br />(public files, own files, shared files, other users' files, app's files, own app user's files, other users' app user's files)|:white_check_mark:<br />(own files)|:white_check_mark:<br />(own files)|
|Share files|:white_check_mark:<br />(own files)|:white_check_mark:<br />(own files)|:white_check_mark:<br />(own files)|
|**Prompts**<br /> (global (public) vs user's)|||
|Add prompt|:white_check_mark:<br />(global prompts, own prompts, other users' prompts)|:white_check_mark:<br />(own prompts)|:white_check_mark:<br />(own prompts)|
|List prompts|:white_check_mark:<br />(global prompts, own prompts, other users' prompts)|:white_check_mark:<br />(public prompts (according to rules), own prompts, shared prompts)|:white_check_mark:<br />(public prompts (according to rules), own prompts, shared prompts)|
|Read prompt|:white_check_mark:<br />(global prompts, own prompts, other users' prompts, prompts under review)|:white_check_mark:<br />(public prompts (according to rules), own prompts, shared prompts)|:white_check_mark:<br />(public prompts (according to rules), own prompts, shared prompts)|
|Edit (Update) prompt|:white_check_mark:<br />(global prompts, own prompts, other users' prompts)|:white_check_mark:<br />(own prompts, shared (for WRITE) prompts)|:white_check_mark:<br />(own prompts, shared (for WRITE) prompts)|
|Publish prompts|:white_check_mark:<br />(global prompts)|:white_check_mark:<br />(own prompts)|:white_check_mark:<br />(own prompts)|
|Approve publish prompts|:white_check_mark:|:x:|:x:|
|Share prompts|:white_check_mark:<br />(own prompts)|:white_check_mark:<br />(own prompts, shared prompts (with re-sharing permissions))|:white_check_mark:<br />(own prompts, shared prompts (with re-sharing permissions))|


## API Keys

API keys, combined with roles and configuration settings, provide a mechanism for managing how applications and services interact with your resources. 

Here's how it works:

**Configuration and Management:** The `aidial.config.json` file in DIAL Core is where you define API keys, their roles, and the associated access limitations. This centralized configuration allows for granular management of API access and resource utilization.

> Refer to [DIAL Core](https://github.com/epam/ai-dial-core/blob/development/sample/aidial.config.json) to view configuration examples.

**Role-Based Access:** API keys are assigned specific roles, which dictate the resources they can access. These roles are linked to system resources like applications, models, toolsets, files, conversations and prompts.

**Defining Access and Restrictions:** You create an API key and assign it a role (e.g., "user"). Then, you define the permissions and limitations associated with that role. For example, the "user" role might grant access to the "chat-gpt-35-turbo" model but with specific usage limits (tokens per minute, day, etc.).

> Refer to [Roles and Access Control for API Keys](/docs/tutorials/2.devops/2.auth-and-access-control/1.api-key-roles.md) to learn how to configure roles and limits for API keys.

## JWT

DIAL allows you to control how chat users access system resources. This is achieved by integrating with your existing identity service provider (IDP) and using roles for granular access management. 

**IDP Integration:** DIAL connects with your IDP (e.g., Azure Active Directory) to manage users and groups. You define user roles and groups within your IDP, which are then passed to DIAL Core through JWT (JSON Web Token). Refer to [Configure IDPs Tutorials](/docs/tutorials/2.devops/2.auth-and-access-control/3.configure-idps/0.overview.md) to learn what IDPs are supported and how to configure this integration.

**Role-Based Access Control:** In the DIAL Core configuration, you specify which user roles from your IDP have access to specific resources (applications, models, toolsets, files, conversations and prompts). For example, you can grant the "operator" role access to the "chat-gpt-35-turbo" model. Refer to [JWT Roles & Limits](/docs/tutorials/2.devops/2.auth-and-access-control/2.chat-users-roles.md) to learn how to configure roles.

**Usage Limits by Role:** You can define usage limits for each role to prevent resource overuse. This could involve setting limits on tokens per minute, day, or month for a specific model. Refer to [JWT Roles & Limits](/docs/tutorials/2.devops/2.auth-and-access-control/2.chat-users-roles.md#add-limits) to learn how to configure limits for roles.
