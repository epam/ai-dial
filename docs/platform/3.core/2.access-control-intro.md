# Access Control in DIAL

## Introduction

This article describes authorization in DIAL. Authorization rules can usually be defined by specifying **Object** of access (what we protect?), **Subject** of access (who we give access to?) and **Action** (what kind of access is given). This article follows this principle for better structuring: it defines Objects, Subjects, authorization rules and mechanisms, how these rules are managed in DIAL.

![](img/acl1.png)

## Objects

In DIAL, **Objects** refer to entities accessible by users. These include Models, Applications, Toolsets, Files, Prompts, and Conversations. A complete list is provided in the summary table in the [Appendix](#appendix---access-control-list-acl-in-dial-core). 

> **Note**: In DIAL documentation, the term *Resources* may be used as a synonym for Objects. However, in this article, we will use the term Objects to emphasize their role in authorization rules. 

Technically, [DIAL Core](/docs/platform/3.core/0.about-core.md) manages all objects, handling persistence and associated business logic. 

On a low level, objects can be defined in two ways:

* Declaratively via configuration files. For brevity, in this document, we will use the term “pre-configured objects” for objects defined in configuration files. All such Objects belong to so-called "dynamic settings" of DIAL Core and can be updated in the configuration files and applied without restarting DIAL Core services. They are immutable via API. Refer to [Tutorials](/docs/tutorials/2.devops/1.configuration/0.configuration-guide.md#dynamic-settings) to learn how to configure dynamic setting for DIAL Core.
* Through the [Unified APIs](/docs/platform/3.core/0.about-core.md#unified-api). We will use the term “runtime objects” for such objects.

This dual approach to managing Objects provides users the freedom to choose a configuration strategy based on their business case. For example, centralized management via configuration files is suitable for setups where the DIAL administration team prefers to leverage an Infrastructure as Code approach, whereas the API is suitable for situations where Objects should be created by regular users. A combination of both approaches is also fully supported. 

![](img/acl2.png)

**Note**: There are Objects which can be defined only via configuration files and do not have APIs, and vice versa.

> * For general configuration guidelines, refer to [Configuration Guide](/docs/tutorials/2.devops/1.configuration/0.configuration-guide.md#general-method-of-configuration).
> * For details about DIAL Core dynamic settings, please refer to [Tutorials](/docs/tutorials/2.devops/1.configuration/0.configuration-guide.md#dynamic-settings).
> * DIAL Core API reference is available on the [DIALX landing website](https://dialx.ai/dial_api).

### DIAL Chat UI and DIAL Admin Panel

While DIAL Core is responsible for managing Objects via configuration files and APIs, DIAL provides the following UI tools to manage Objects:

* [DIAL Chat UI](/docs/platform/4.chat/0.about-chat.md): Allows users to work with runtime objects via API.
* [DIAL Admin Panel](/docs/platform/11.admin-panel.md): Allows admin users to work with pre-configured objects.

Both applications work on top of DIAL Core and rely on DIAL Core’s access control mechanisms, which is why this article focuses on DIAL Core authorization.

## Subjects

Subjects are actors who access Objects, trying to create, update, delete, read, or use them.

In DIAL, Subjects include end-users, API Keys (used by external applications), or DIAL Applications acting on a user's behalf. 

* End-users authenticate in DIAL Core using JWT access tokens.
* API Keys are used by external applications to access DIAL Core without user context.
* DIAL Applications use internally-generated [Per-Request Keys](/docs/platform/3.core/3.per-request-keys.md) that include information about both the application and the user. In this case on one hand, the DIAL Application acts on behalf of the user (who has certain permissions), but on the other hand, DIAL Applications are not fully trusted and should be limited in what they can do. This scenario is covered in a separate section of this article.  

### Roles as a Subject

DIAL also supports the notion of **Roles** to avoid managing access individually for every user or API Key. 

A Role can be associated with multiple individual Subjects, such as Users, User Groups and API Keys, and then used as a Subject to prove access to Objects in specific scenarios.

![](img/acl3.png)

A Role can only be defined via configuration files (pre-configured object) and not via Core API.

By default, DIAL defines one dedicated role - DIAL Administrators - which has elevated access over DIAL configuration (dynamic settings) and Core API:

* DIAL Administrators role can command DIAL Core to reload “dynamic settings” configuration files without restarting Core services.
* DIAL Administrators role has access to certain Core APIs and Objects that other Subjects cannot access. 

More details on DIAL Administrators role can be found in the sections below, describing DIAL Authorization rules.

#### How to associate a user or API key with a role

* User (JWT Token): A User is represented by a JWT token issued by an identity service provider (IDP) and mapped to the Roles using claim values in the token. Refer to [Tutorials](/docs/tutorials/2.devops/2.auth-and-access-control/2.chat-users-roles.md) to learn how it works.
* API Key: An API Key can be defined only in the configuration file and must include a "roles" attribute specifying the roles assigned to the key. For more details, refer to [Programmatic Auth](/docs/tutorials/2.devops/2.auth-and-access-control/0.programmatic-auth.md).

Now that we have defined Subjects, we need a way to associate them with Objects to create an Authorization Rule.

## Authorization Rules

In this article we use the following logical notation for the Authorization rule, allowing access for a `{set-of-subjects}` to a `{set-of-objects}`:

`(object: {set-of-objects}, subject: {set-of-subjects}, action: {actions}) `

> **Note**: This notation is not how DIAL stores or interprets Authorization rules. It was made up for the purpose of this article, for the sake of unification and brevity.

## Authorization Mechanisms

DIAL uses various mechanisms to maintain and enforce Authorization rules in different business scenarios. They include **Public** and **Private** spaces, publication and Objects sharing, which will be described in the following sections.

![](img/acl4.png)

### Default Authorization Rules: Public and Private Spaces

DIAL supports two logical spaces for all Objects: **Public** and **Private**. Every Object belongs to only one of the spaces.

* The Public space allows making objects available to a wide audience while maintaining full control and governance.
* The Private space assumes objects are available only to their creators (owners) by default. This allows regular users to work with DIAL without compromising their privacy, as the objects they create cannot be accessed by anyone else unless explicitly stated (will be described further in text).

As their names assume, the two spaces define default [authorization rules](#authorization-rules), applied to their resources: 

* Any resource in a Public space is available in READ-ONLY mode for any user by default, unless access is restricted as shown further in the article (see Publishing and Rules sections); WRITE operations are allowed only for the role of DIAL Administrators. Default Authorization rules in Public space are:
    - `(object: public:*, subject: *, action: read)` - default READ-ONLY access in public space.
    - `(object: public:*, subject: role:admin, action: *)` - default full access for users from DIAL Administrators role in public space.

    Where:

    * `public:*` - a wildcard for any object in the public space.
    * `subject: *` - a wildcard for any subject.
    * `role:admin` – notation for all Subjects, belonging to "admin" role. We use the "admin" name for DIAL Administrators role. As was mentioned earlier, Roles can be used as Subjects in definition of Authorization rules.

* Any object in the Private space is available only to its creator (User, API Key) by default, unless access is explicitly granted to another Subject (see Sharing section). Logically, every Subject (user or API Key) has its own private space (see Persistent Storage article for details). The default Authorization Rule in Private space is:
    - `(object: private:subject_id:*, subject: subject_id, action:*)`

    Where:

    * `private:subject_id:*` - Any O in a Private space of a particular Subject (User or API Key), identified by `"subject_id"`.
    * `subject_id` - A unique identifier of a Subject (user or API Key).

#### Pre-configured Objects

All Objects, defined in configuration files, belong to the Public space, so appropriate default Authorization rules apply. Objects cannot be defines in a Private space via configuration file.

#### Runtime Objects

[DIAL Core API](https://dialx.ai/dial_api) allows creating Objects in both Public and Private spaces. As default Authorization rules define, an object in a Public space can only be created by the DIAL Administrators role, while regular users (including user from DIAL Administrators role) or API Keys can create Objects only within their Private space.

![](img/acl5.png)

## Hierarchical Structure of the Public Space

This section provides details about how the Public is structured, which is important for understanding of Authorization rules.

Objects in the Public space are arranged hierarchically, like a file system. This means that every Object logically belongs to a  “sub-folder” within the hierarchy. All pre-configured objects are automatically placed into the “root” folder of the Public space. DIAL Core API allows specifying a sub-folder for newly-created Objects.

![](img/acl6.png)

As you will see below, authorization restrictions can be applied to any sub-folder in the hierarchy. The effective Authorization rule for an Object in a sub-folder includes restrictions applied to all parent sub-folders up to the “root” folder.

## How to Restrict Access in the Public Space

Default public access to Objects in the Public space can be narrowed/restricted as needed.

### Pre-Configured Objects

We can use the `"userRoles"` attribute in the Object's definition to list all Roles that should have access to the Object. It creates the following Authorization rule that overrides the default public read-only access:

`(object: public:object_id, subject: role:{list-of-roles-via-OR}, action: read)`

Where:

* `public:object_id` – A particular Object in the Public space (in our case, defined in a configuration file).
* `role:{list-of-roles-via-OR}` – Any User or API Key that belong to any of the Roles (Role1 OR Role2 OR…OR RoleN), specified in `"userRoles"` attribute of the Object definition in the DIAL Core configuration file.

### Runtime Objects

As mentioned above, for Runtime objects, the Public space supports hierarchical structure, similar to a file system. Objects can be placed (or published) to the root folder or any sub-folder within this hierarchy. 

Each sub-folder (with the exception of the root folder) can be assigned one or many attribute-based logical predicates, describing Subjects that need access to this sub-folder. These predicates are called `"rules"`. E.g. `“group == my-role”`.

![](img/acl7.png)

The effective set of rules for each sub-folder includes all rules associated with the sub-folder (via OR) and all the rules inherited from the parent sub-folders (via AND). The final Authorization rule for Objects in a sub-folder looks like:

`(object: public:sub_folder_path:*, subject: {effective-set-of-rules}, action: read)`

Where:

* `public:sub_folder_path:*` - Any Object in a sub-folder of the Public space.
* `{effective-set-of-rules}` – A logical expression, combining all Rules from the parent sub-folders (via AND), with each sub-folder rule being a set of predicates joined by OR.

Rules associated with sub-folders can be created by either DIAL Administrators or regular users via the [Publication process](/docs/tutorials/1.developers/1.work-with-resources/0.work-with-publications.md). Publication is the only way for regular users to add Objects to the Public space, which requires an explicit approval from DIAL Administrators.

## How to Provide Access in the Private Space

Default access, limited by the Private space’s owner, can be extended as needed.

### Pre-Configured Objects

**N/A** - As was mentioned earlier in this article, configuration files place Objects only to the Public space.

### Runtime Objects

As discussed earlier, by default, only the Object's creator (e.g. Private space’s owner) maintains full access to the Object in the Private space. The Object's creator may want to provide access to other users. In this case, they can generate a temporary Sharing link for the object, specifying the kind of access required (READ or READ/WRITE). The link can be sent to any DIAL user. When the link is used, the following Authorization rule is created:

`(object: private:subject_id:object_id, subject: {user-id-who-used-the-link}, action: {action-specified-by-the-link})`

Where:

* `Private:subject_id:object_id` – A particular Resource in a Private space of the particular Subject (User or API Key).
* `{user-id-who-used-the-link}` – A particular user who activated the link (accepted invite).
* `{action-specified-by-the-link}` – READ or READ/WRITE type of permissions, specified by Resource's creator while creating the Sharing link. Refer to [Sharing](/docs/tutorials/1.developers/1.work-with-resources/1.sharing.md) for details.

## Special Subject: DIAL Application Acting on User’s Behalf

In the preceding sections, we examined the Authorization Rules applicable to standard Subjects, including Users and API Keys. We reviewed the default access privileges in both Public and Private spaces, as well as methods for refining or extending these permissions as required. 

There is a special case when user or API Key allows DIAL Application to act on their behalf. For example, a user invokes a DIAL Application A, which calls DIAL Core services (e.g. File API), another Application B or a Model M. In such case, the Application uses a so called [per-request key](/docs/platform/3.core/3.per-request-keys.md), that contains information about both Application A and the User (or API Key). Logically, since Application acts as a User, it should have the same level of access in DIAL. However, since Applications in DIAL are also Objects, and can be created and deployed by any user, they can potentially contain malicious code and cannot be fully trusted. It means that their access should be minimized to reduce potential negative impact.

Because a per-request key represents both User and Application, it has access to both user’s and Application’s Objects. Applications in DIAL also have their Private space, where an Application (acting via a Per-request key) can store and, later, access its Objects.

Below, is the summary of what DIAL Application, acting on behalf of a User or API Key via a per-request key, can access in DIAL:

* Normally, User or API Key can access all Objects in their Private space without restrictions. A per-request key for the same user or API Key has access to only Application’s dedicated sub-folder within user’s Private space:
    - `(object: private:subject_id:app_id:*, subject: per-request-key, action: read/write)`, where `private:subject_id:app_id:*` is any Object in Application-dedicated (`app_id`) sub-folder within User or API Key’s (subject_id) Private space.
* Application’s Private space (note, that a per-request key of any user has access to the Application’s private space):
    - `(object: private:app_id:*, subject: per-request-key, action: read/write)`, where `private:app_id:*` is any Object in Application’s Private space.

## Appendix - Access Control List (ACL) in DIAL Core

### Access patterns, used in the ACL table

| Space   | Access Pattern | Description    |
|--|--------------|----|
| **Public space** | Public objects| Read-only access to public objects with no restrictions. For “executable objects,” such as Applications, Routes, or Toolsets, it also includes “execute” or “call” permissions. |
|  | Restricted objects    | Read-only access to objects with matching Rules.  |
|  | Admin access| • Full read/write access to any object in Public space.<br /> • Core configuration files are managed by DIAL Administrators.<br /> • Approve/Reject publication requests.  |
| **Private space** | Own objects  | • Full read/write access to any object in own Private space.<br /> • Submit publication requests for the objects.<br /> • Create sharing links (share) for the objects.   |
|  | Own objects per application | Full access to any object in Application-specific sub-folder in own Private space.     |
|  | Application objects   | Full access to any object in Application’s Private space.|
|  | Shared objects | Access to the shared object, level of access is defined in the share link:<br /> • Read<br /> • Read/write<br /> • Optionally re-share (in combination with read or read/write). |

### ACLs for Objects

| Object         | DIAL Administrator      | User w/o Role    | User / API Key w/ Role(s)     | Per-request Key <br />Note: DIAL Administrators  permissions do not apply to per-requests keys      |
|----------------|-------------------|----------|--------------|------------------|
| **Models**<br />Note: Models are managed only via configuration files     | Public space: <br />• Admin access<br />Private space: <br />• N/A                              | Public space: <br />• Public objects<br />Private space: <br />• N/A                                | Public space: <br />• Public objects<br />• Restricted objects<br />Private space: <br />• N/A         | Public space: <br />• Public objects<br />• Restricted objects<br />Private space: <br />• N/A         |
| **Applications** | Public space: <br />• Admin access<br />Private space: <br />• Own objects<br />• Shared objects | Public space: <br />• Public objects<br />Private space: <br />• Own objects<br />• Shared objects (TBD – what about sub-resources (e.g. files, routes?)) | Public space: <br />• Public objects<br />• Restricted objects<br />Private space: <br />• Own objects<br />• Shared objects | Public space: <br />• Public objects<br />• Restricted objects<br />Private space: <br />• Own objects per application<br />• Application objects |
| **Toolsets**   | Public space: <br />• Admin access<br />Private space: <br />• Own objects<br />• Shared objects | Public space: <br />• Public objects<br />Private space: <br />• Own objects<br />• Shared objects | Public space: <br />• Public objects<br />• Restricted objects<br />Private space: <br />• Own objects<br />• Shared objects | Public space: <br />• Public objects<br />• Restricted objects<br />Private space: <br />• Own objects per application<br />• Application objects |
| **Routes**<br />Note: Routes are managed only via configuration files     | Public space: <br />• Admin access<br />Private space: <br />• N/A                              | Public space: <br />• Public objects<br />Private space: <br />• N/A                                | Public space: <br />• Public objects<br />• Restricted objects<br />Private space: <br />• N/A         | Public space: <br />• Public objects<br />• Restricted objects<br />Private space: <br />• N/A         |
| **Files**      | Public space: <br />• Admin access<br />Private space: <br />• Own objects<br />• Shared objects | Public space: <br />• Public objects<br />Private space: <br />• Own objects<br />• Shared objects | Public space: <br />• Public objects<br />• Restricted objects<br />Private space: <br />• Own objects<br />• Shared objects | Public space: <br />• Public objects<br />• Restricted objects<br />Private space: <br />• Own objects per application<br />• Application objects |
| **Prompts**    | Public space: <br />• Admin access<br />Private space: <br />• Own objects<br />• Shared objects | Public space: <br />• Public objects<br />Private space: <br />• Own objects<br />• Shared objects | Public space: <br />• Public objects<br />• Restricted objects<br />Private space: <br />• Own objects<br />• Shared objects | Public space: <br />• Public objects<br />• Restricted objects<br />Private space: <br />• Own objects per application<br />• Application objects |
| **Conversations** | Public space: <br />• Admin access<br />Private space: <br />• Own objects<br />• Shared objects | Public space: <br />• Public objects<br />Private space: <br />• Own objects<br />• Shared objects | Public space: <br />• Public objects<br />• Restricted objects<br />Private space: <br />• Own objects<br />• Shared objects | Public space: <br />• Public objects<br />• Restricted objects<br />Private space: <br />• Own objects per application<br />• Application objects |

### ACLs for Special Objects

Special Objects represent a part of DIAL’s Authorization system and do not belong to a Public or Private spaces.

| Object  | DIAL Administrator   | User w/o Role     | User / API Key w/ Role(s) | Per-request Key <br />Note: DIAL Administrators  permissions do not apply to per-requests keys    |
|--|---------|-----------|-----------|-|
| **Keys**<br />Note: Keys are managed only via configuration files; <br />Keys cannot be listed or otherwise accessed via API, even in “read-only” mode. User can make a call to /v1/user/info, authenticated by a Key, to obtain limited information about the Key| + | - | - | -      |
| **Roles**<br />Note: Roles are managed only via configuration files;<br /> Roles cannot be listed or otherwise accessed via API, even in “read-only” mode|  + | - | - | -      |-      |

### ACLs for Core APIs, not related to Objects

| Core API| DIAL Administrator | User w/o Role     | User / API Key w/ Role(s) | Per-request Key <br />  Note: DIAL Administrators  permissions do not apply to per-requests keys  |
|--|---------------|-----------|-----------|-----------|
| Get User Info  | Information about current user  |
| Reload Config  | + | - | - | - |