# Overview

Web-based authentication and authorization is performed via JWT and integration with various identity service providers (IDPs). 

## Authentication 

To authenticate chat users, we verify their identity. This is the high-level overview of the chat users authentication process:

1. Configure user groups and users in your identity service provider.
2. Configure AI DIAL Core and Chat to work with your identity service provider.
3. When users log into the chat application, the request is sent to the corresponding identity service provider to verify user's identity. This process is built around using JWT. Refer to [example](#configuration) to learn how to do it.

## Authorization 

To authorize logged-in chat users, we check their permissions. You can manage access to such system resources as models, applications, addons, assistants and restrict the number of tokens sent to models. This is the high-level overview of the chat users authorization process:

1. Configure user groups and users in your identity service provider.
2. Configure AI DIAL Core and Chat to work with your identity service provider and assign roles and limits matching the configurations in your IDP.
3. For each logged in user, the system checks their roles in AI DIAL Core configuration to determine the permissions to access particular system resources. Refer to [example](#configuration) to learn how to do it.

## Configuration Example

### Configure IDP

The first step is to choose and configure an identity service provider. 

> Refer to [Auth0](https://docs.epam-rail.com/Deployment/idp-configuration/auth0), [AWS Cognito](./IDPs/cognito), [MS Entra](./IDPs/entraID), [Google OAuth2](./IDPs/google), [Keycloak](./IDPs/keycloak), [Okta](./IDPs/okta) to view how to enable them as an identity and access management solution for AI DIAL users.

### Configure AI DIAL

For example purposes, lets configure rate limits for AI DIAL Chat users with user roles managed in Microsoft Entra. 

1. [Configure Microsoft Entra](https://docs.epam-rail.com/Deployment/idp-configuration/entraID#configure-microsoft-entra-id): create application, client secret, and user group.
2. [Configure AI DIAL Chat](https://docs.epam-rail.com/Deployment/idp-configuration/entraID#ai-dial-chat-settings) to work with MS Entra.
3. [Configure AI DIAL Core](https://docs.epam-rail.com/Deployment/idp-configuration/entraID#ai-dial-core-settings) to work with MS Entra.
4. [Assign roles](https://docs.epam-rail.com/Deployment/idp-configuration/entraID#assignment-of-roles) you have created in MS Entra to a selected model in AI DIAL Core configuration. In this example, "azure-group-name" role from the "groups" claim is configured for chat-gpt-35-turbo model:

      ```json
      "models": {
          "chat-gpt-35-turbo": {
            "type": "chat",
            "endpoint" : "http://localhost:7001/v1/openai/deployments/gpt-35-turbo/chat/completions",
            "upstreams": [
              {"endpoint": "http://localhost:7001", "key": "modelKey1"}
            ],
            "userRoles": ["azure-group-name"]
          }
      }
      ```
5. In AI DIAL Core configuration file, in the `roles` section, add your role ("azure-group-name") and limits for it. Refer to [configuration example](https://github.com/epam/ai-dial-core/blob/9d7e3ba8380ffea3b9b6a7ccd65a96f024e842e3/sample/aidial.config.json#L191) for example purposes. For `roles.<role_name>.limits` you can configure `minute` (total tokens per minute limit sent to the model, managed via floating window approach for well-distributed rate limiting. If it's not set the default value is unlimited) or `day` (total tokens per day limit sent to the model, managed via floating window approach for balanced rate limiting. If it's not set the default value is unlimited).

        > The `default` role applies in case other roles are not configured.
        > In case the same user has different roles with different limits, the role with the higher limit is an effective role.

        ```json
        "roles": {
            "azure-group-name": {
                "limits": {
                    "chat-gpt-35-turbo": {
                        "minute": "200000",
                        "day": "10000000"
                    }
                }
            },
            "default": {
                "limits": {
                    "chat-gpt-35-turbo": {
                        "minute": "200000",
                        "day": "10000000"
                    }
                }
            },
        }
        ```