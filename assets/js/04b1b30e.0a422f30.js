"use strict";(self.webpackChunkdial=self.webpackChunkdial||[]).push([[0],{28453:(e,n,i)=>{i.d(n,{R:()=>o,x:()=>a});var t=i(96540);const s={},r=t.createContext(s);function o(e){const n=t.useContext(r);return t.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function a(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(s):e.components||s:o(e.components),t.createElement(r.Provider,{value:n},e.children)}},36277:(e,n,i)=>{i.r(n),i.d(n,{assets:()=>d,contentTitle:()=>a,default:()=>h,frontMatter:()=>o,metadata:()=>t,toc:()=>l});const t=JSON.parse('{"id":"tutorials/devops/deployment/azure-deployment-guide","title":"Azure Deployment Guide","description":"Prerequisites","source":"@site/docs/tutorials/2.devops/0.deployment/2.azure-deployment-guide.md","sourceDirName":"tutorials/2.devops/0.deployment","slug":"/tutorials/devops/deployment/azure-deployment-guide","permalink":"/tutorials/devops/deployment/azure-deployment-guide","draft":false,"unlisted":false,"tags":[],"version":"current","sidebarPosition":2,"frontMatter":{},"sidebar":"CustomSideBar","previous":{"title":"Azure Secrets Deployment","permalink":"/tutorials/devops/deployment/azure-secrets"},"next":{"title":"GCP Deployment Guide","permalink":"/tutorials/devops/deployment/gcp-deployment-guide"}}');var s=i(74848),r=i(28453);const o={},a="Azure Deployment Guide",d={},l=[{value:"Prerequisites",id:"prerequisites",level:2},{value:"Scalability",id:"scalability",level:2},{value:"DIAL Services",id:"dial-services",level:3},{value:"Language Models",id:"language-models",level:3},{value:"High Availability",id:"high-availability",level:2},{value:"Disaster Recovery",id:"disaster-recovery",level:2},{value:"Support",id:"support",level:2}];function c(e){const n={a:"a",h1:"h1",h2:"h2",h3:"h3",header:"header",img:"img",li:"li",p:"p",table:"table",tbody:"tbody",td:"td",th:"th",thead:"thead",tr:"tr",ul:"ul",...(0,r.R)(),...e.components};return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(n.header,{children:(0,s.jsx)(n.h1,{id:"azure-deployment-guide",children:"Azure Deployment Guide"})}),"\n",(0,s.jsx)(n.h2,{id:"prerequisites",children:"Prerequisites"}),"\n",(0,s.jsx)(n.p,{children:"The below diagram displays all cloud Azure infrastructure services required for the DIAL deployment:"}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.img,{alt:"mid-zoom",src:i(68284).A+"",width:"456",height:"754"})}),"\n",(0,s.jsx)(n.p,{children:"The table below summarizes service tiers recommended for a production deployment. Lower environments may not use zone redundant configurations to save costs."}),"\n",(0,s.jsxs)(n.table,{children:[(0,s.jsx)(n.thead,{children:(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.th,{children:"Service"}),(0,s.jsx)(n.th,{children:"Tier"})]})}),(0,s.jsxs)(n.tbody,{children:[(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:"Azure Kubernetes Service"}),(0,s.jsx)(n.td,{children:"Standard, zone-redundant"})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:"Load Balancer"}),(0,s.jsx)(n.td,{children:"Standard"})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:"Storage Account"}),(0,s.jsx)(n.td,{children:"Standard, Azure Blob Storage, GZRS"})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:"Azure Cache for Redis"}),(0,s.jsx)(n.td,{children:"Premium P1, zone-redundant"})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:"OpenAI"}),(0,s.jsx)(n.td,{children:"Depends on the capacity requirements and models \u2013 both provisioned throughput and pay-as-you-go models can be used"})]})]})]}),"\n",(0,s.jsx)(n.p,{children:"There are a few dependencies, where the technology choice may depend on the corporate standards. The table below summarizes Azure services that can be used to implement each of these dependencies if there isn't any corresponding corporate standard."}),"\n",(0,s.jsxs)(n.table,{children:[(0,s.jsx)(n.thead,{children:(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.th,{children:"Dependency"}),(0,s.jsx)(n.th,{children:"Azure Service"})]})}),(0,s.jsxs)(n.tbody,{children:[(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:"SSO"}),(0,s.jsx)(n.td,{children:"Azure Active Directory"})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:"Firewall"}),(0,s.jsx)(n.td,{children:"Azure Application Gateway with WAF"})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:"Logging and monitoring tools"}),(0,s.jsx)(n.td,{children:"Azure Application Insights and Log Analytics"})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:"Container registry"}),(0,s.jsx)(n.td,{children:"Azure Container Registry"})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:"Secret Storage"}),(0,s.jsx)(n.td,{children:"Azure Key Vault"})]})]})]}),"\n",(0,s.jsx)(n.h2,{id:"scalability",children:"Scalability"}),"\n",(0,s.jsx)(n.p,{children:"There are two sets of resources, each of which has its own recommended scaling approach: DIAL services and LLM models."}),"\n",(0,s.jsx)(n.h3,{id:"dial-services",children:"DIAL Services"}),"\n",(0,s.jsx)(n.p,{children:"DIAL services are stateless, so can have multiple copies running concurrently. As a baseline, a production deployment should have two copies of each service running on different nodes to achieve high availability of the solution. Usually there is no need to scale DIAL services further, because they are not resource-intensive and can handle an organization with thousands of DIAL users."}),"\n",(0,s.jsx)(n.p,{children:"However, to be resilient to load spikes, it is recommended to configure autoscaling for DIAL Core service so that more copies are run if the total CPU usage across all instances goes beyond a certain threshold for a certain duration (e.g. more 80% of the total CPU limit for 1 minute)."}),"\n",(0,s.jsx)(n.p,{children:"Apart from that, cluster autoscaling should be configured as well to add an extra node in case the already existing nodes do not have capacity to run a new copy of the DIAL Core service."}),"\n",(0,s.jsx)(n.h3,{id:"language-models",children:"Language Models"}),"\n",(0,s.jsx)(n.p,{children:"Scaling of LLM model instances is a common scenario for DIAL, because a single instance is usually not enough for an organization due to the model\u2019s request rate limits. With OpenAI service in Azure, there are four levels of scaling:"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:"Increasing the number of model instances in the same region."}),"\n",(0,s.jsx)(n.li,{children:"Requesting a regional quota extension for a model - every region has a fixed quota for every model type in terms of tokens per minute (TPM). The sum of model instance capacities within the same region can\u2019t exceed this quota. If the current quota is not enough, in some cases it is possible to request the extension via the Azure Portal."}),"\n",(0,s.jsx)(n.li,{children:"Creating model instances in other regions."}),"\n",(0,s.jsx)(n.li,{children:"Using multiple subscriptions to access model endpoints."}),"\n"]}),"\n",(0,s.jsx)(n.p,{children:"It makes sense to use any approach from above only if the previous one doesn\u2019t help anymore."}),"\n",(0,s.jsx)(n.h2,{id:"high-availability",children:"High Availability"}),"\n",(0,s.jsx)(n.p,{children:"High availability is achieved via zone redundancy:"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:"Running multiple copies of DIAL services in different availability zones by utilizing a multi-zone AKS cluster."}),"\n",(0,s.jsx)(n.li,{children:"Using highly available configurations of other Azure services."}),"\n"]}),"\n",(0,s.jsx)(n.p,{children:"Here is a reference list of availability SLA metrics for the Azure services used by the solution."}),"\n",(0,s.jsxs)(n.table,{children:[(0,s.jsx)(n.thead,{children:(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.th,{children:"Service"}),(0,s.jsx)(n.th,{children:"Availability SLA"}),(0,s.jsx)(n.th,{children:"Resilient to zone-wide outages"})]})}),(0,s.jsxs)(n.tbody,{children:[(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:"Azure Kubernetes Service"}),(0,s.jsx)(n.td,{children:"99.95% if deployed with zone redundancy"}),(0,s.jsx)(n.td,{children:"Yes, if configured explicitly"})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:"Key Vault"}),(0,s.jsx)(n.td,{children:"99.99%"}),(0,s.jsx)(n.td,{children:"Yes"})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:"Storage Account"}),(0,s.jsx)(n.td,{children:"99.99% (read), 99.9% (write)"}),(0,s.jsx)(n.td,{children:"Yes, if configured explicitly"})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:"Azure Cache for Redis"}),(0,s.jsx)(n.td,{children:"99.9% if deployed with zone redundancy"}),(0,s.jsx)(n.td,{children:"Yes, if configured explicitly"})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:"OpenAI"}),(0,s.jsx)(n.td,{children:"No SLA"}),(0,s.jsx)(n.td,{})]})]})]}),"\n",(0,s.jsx)(n.p,{children:"Since OpenAI doesn\u2019t have an SLA, it is worth having multiple endpoints in different regions. If one endpoint fails, DIAL will automatically attempt the next one in the list, ensuring resilience."}),"\n",(0,s.jsx)(n.h2,{id:"disaster-recovery",children:"Disaster Recovery"}),"\n",(0,s.jsxs)(n.p,{children:["DIAL has two components: ",(0,s.jsx)(n.a,{href:"/platform/architecture-and-concepts/components#dial-core",children:"DIAL Core"})," and ",(0,s.jsx)(n.a,{href:"/platform/architecture-and-concepts/components#analytics-realtime",children:"DIAL Analytics"}),". Since Analytics Realtime is an optional component that can be managed separately from the DIAL Core, it is better to separate disaster recovery policies for both."]}),"\n",(0,s.jsx)(n.p,{children:"The DIAL Core part consists of a set of stateless services and a single permanent storage based on Azure Storage account (Redis in this case is treated as stateless, because it serves only as a cache for the primary storage and can be safely restarted if necessary). In case of a region-wide failure, the entire set of components must be run in a different region:"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:"Storage account \u2013 since it uses GZRS redundancy, in case of a disaster it can be failed over to the secondary region. After the successful failover it will have only one region (ZRS), so to restore an ability to fail it over once again during the next disaster, the mode should be explicitly set to GZRS again."}),"\n",(0,s.jsx)(n.li,{children:"All other services \u2013 since they are stateless, the entire set of services can be deployed in the secondary region from scratch and the DIAL instance domain name re-routed to the new entry point. Depending on the RTO requirement, this step can be sped up by having a passive instance of DIAL Core always deployed in the secondary region and activated in case of a failure."}),"\n"]}),"\n",(0,s.jsx)(n.p,{children:"When the primary region is restored, there is no need to fail back."}),"\n",(0,s.jsx)(n.h2,{id:"support",children:"Support"}),"\n",(0,s.jsx)(n.p,{children:"It is recommended to configure monitoring and alerts to manage the DIAL deployment. To seamlessly host DIAL in diverse enterprise environments, it provides standard interfaces for logs and metrics collection via OpenTelemetry interfaces.\nSpecific tools used for logging, monitoring and alerting purposes depend on the corporate standards of each customer."})]})}function h(e={}){const{wrapper:n}={...(0,r.R)(),...e.components};return n?(0,s.jsx)(n,{...e,children:(0,s.jsx)(c,{...e})}):c(e)}},68284:(e,n,i)=>{i.d(n,{A:()=>t});const t=i.p+"assets/images/azure-deployment-04ff26a4b9443db453064a9f74a2554d.svg"}}]);