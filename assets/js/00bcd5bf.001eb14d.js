"use strict";(self.webpackChunkdial=self.webpackChunkdial||[]).push([[8215],{35305:(e,i,n)=>{n.r(i),n.d(i,{assets:()=>c,contentTitle:()=>o,default:()=>u,frontMatter:()=>s,metadata:()=>a,toc:()=>l});var t=n(85893),r=n(11151);const s={},o="How to Set Azure AD B2C as Identity Provider",a={id:"tutorials/devops/auth-and-access-control/configure-idps/azureb2c",title:"How to Set Azure AD B2C as Identity Provider",description:"Table of Contents",source:"@site/docs/tutorials/2.devops/2.auth-and-access-control/2.configure-idps/azureb2c.md",sourceDirName:"tutorials/2.devops/2.auth-and-access-control/2.configure-idps",slug:"/tutorials/devops/auth-and-access-control/configure-idps/azureb2c",permalink:"/tutorials/devops/auth-and-access-control/configure-idps/azureb2c",draft:!1,unlisted:!1,tags:[],version:"current",frontMatter:{},sidebar:"CustomSideBar",previous:{title:"cognito",permalink:"/tutorials/devops/auth-and-access-control/configure-idps/cognito"},next:{title:"entraID",permalink:"/tutorials/devops/auth-and-access-control/configure-idps/entraID"}},c={},l=[{value:"Table of Contents",id:"table-of-contents",level:2},{value:"Introduction",id:"introduction",level:2},{value:"Configuration Guidelines",id:"configuration-guidelines",level:2},{value:"Configure Azure AD B2C",id:"configure-azure-ad-b2c",level:3},{value:"Configure DIAL",id:"configure-dial",level:3},{value:"DIAL Chat Settings",id:"dial-chat-settings",level:4},{value:"DIAL Core Settings",id:"dial-core-settings",level:4},{value:"Assignment of Roles",id:"assignment-of-roles",level:4}];function d(e){const i={a:"a",blockquote:"blockquote",code:"code",h1:"h1",h2:"h2",h3:"h3",h4:"h4",li:"li",ol:"ol",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,r.a)(),...e.components};return(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(i.h1,{id:"how-to-set-azure-ad-b2c-as-identity-provider",children:"How to Set Azure AD B2C as Identity Provider"}),"\n",(0,t.jsxs)("div",{class:"docusaurus-ignore",children:[(0,t.jsx)(i.h2,{id:"table-of-contents",children:"Table of Contents"}),(0,t.jsxs)(i.ul,{children:["\n",(0,t.jsx)(i.li,{children:(0,t.jsx)(i.a,{href:"#introduction",children:"Introduction"})}),"\n",(0,t.jsxs)(i.li,{children:[(0,t.jsx)(i.a,{href:"#configuration-guidelines",children:"Configuration Guidelines"}),"\n",(0,t.jsxs)(i.ul,{children:["\n",(0,t.jsx)(i.li,{children:(0,t.jsx)(i.a,{href:"#configure-microsoft-entra-id",children:"Configure Azure AD B2C"})}),"\n",(0,t.jsxs)(i.li,{children:[(0,t.jsx)(i.a,{href:"#configure-dial",children:"Configure DIAL"}),"\n",(0,t.jsxs)(i.ul,{children:["\n",(0,t.jsx)(i.li,{children:(0,t.jsx)(i.a,{href:"#dial-chat-settings",children:"DIAL Chat Settings"})}),"\n",(0,t.jsx)(i.li,{children:(0,t.jsx)(i.a,{href:"#dial-core-settings",children:"DIAL Core Settings"})}),"\n",(0,t.jsx)(i.li,{children:(0,t.jsx)(i.a,{href:"#assignment-of-roles",children:"Assignment of Roles"})}),"\n"]}),"\n"]}),"\n"]}),"\n"]}),"\n"]})]}),"\n",(0,t.jsx)(i.h2,{id:"introduction",children:"Introduction"}),"\n",(0,t.jsxs)(i.p,{children:["This basic tutorial demonstrates how to configure ",(0,t.jsx)(i.a,{href:"https://learn.microsoft.com/en-us/azure/active-directory-b2c/overview",children:"Azure AD B2C"})," and use it as an identity and access management solution for DIAL users."]}),"\n",(0,t.jsx)(i.h2,{id:"configuration-guidelines",children:"Configuration Guidelines"}),"\n",(0,t.jsx)(i.h3,{id:"configure-azure-ad-b2c",children:"Configure Azure AD B2C"}),"\n",(0,t.jsx)(i.p,{children:"Follow these steps to configure Azure AD B2C:"}),"\n",(0,t.jsxs)(i.ol,{children:["\n",(0,t.jsxs)(i.li,{children:["Create a ",(0,t.jsx)(i.strong,{children:"B2C Tenant"})," if you do not have one: Refer to ",(0,t.jsx)(i.a,{href:"https://learn.microsoft.com/en-us/azure/active-directory-b2c/tutorial-create-tenant",children:"Azure tutorials"})," to learn how to do this. Save the ",(0,t.jsx)(i.strong,{children:"tenant id"})," (",(0,t.jsx)(i.code,{children:"<azure_b2c_tenant_id>"}),") - you will need it to configure DIAL Chat ",(0,t.jsx)(i.code,{children:"AUTH_AZURE_B2C_TENANT_ID"})," environment variable."]}),"\n",(0,t.jsxs)(i.li,{children:["Register an enterprise ",(0,t.jsx)(i.strong,{children:"Web Application"}),": Refer to ",(0,t.jsx)(i.a,{href:"https://learn.microsoft.com/en-us/azure/active-directory-b2c/tutorial-register-applications",children:"Azure tutorials"})," for detailed instructions on how to register a Web application. Upon the registration, make sure to get the following details - you will need them to configure DIAL:","\n",(0,t.jsxs)(i.ul,{children:["\n",(0,t.jsxs)(i.li,{children:["Application ID: Identifier associated with your application in the Azure portal (",(0,t.jsx)(i.code,{children:"<azure_b2c_app_id>"}),")"]}),"\n",(0,t.jsxs)(i.li,{children:["Redirect URI: A URI where authentication responses are sent and received by your app. Follow this format - ",(0,t.jsx)(i.code,{children:"<chat_url>/api/auth/callback/azure-ad-b2c"}),". Replace ",(0,t.jsx)(i.code,{children:"<chat_url>"})," with the actual address of your DIAL Chat application."]}),"\n"]}),"\n"]}),"\n",(0,t.jsxs)(i.li,{children:["Create a ",(0,t.jsx)(i.strong,{children:"Client secret"}),": Refer to ",(0,t.jsx)(i.a,{href:"https://learn.microsoft.com/en-us/azure/active-directory-b2c/tutorial-register-applications#create-a-client-secret",children:"Azure tutorials"})," to learn how to do this. Save a client secret ",(0,t.jsx)(i.code,{children:"<azure_b2c_client_secret>"})," and a ",(0,t.jsx)(i.code,{children:"<azure_b2c_client_id>"})," - you will need them to configure DIAL CHAT ",(0,t.jsx)(i.code,{children:"AUTH_AZURE_B2C_SECRET"})," and ",(0,t.jsx)(i.code,{children:"AUTH_AZURE_B2C_CLIENT_ID"})," environment variables."]}),"\n",(0,t.jsxs)(i.li,{children:["Create a ",(0,t.jsx)(i.strong,{children:"Scope"}),": Scopes are used to manage permissions to protected resources. In the section ",(0,t.jsx)(i.strong,{children:"Manage/Expose an API"}),", add a custom scope ",(0,t.jsx)(i.code,{children:"Chat.Login"})," (",(0,t.jsx)(i.code,{children:"<azure_b2c_tenant_id>.onmicrosoft.com/<azure_b2c_app_id>/Chat.Login"}),"). You will need it to configure DIAL Chat ",(0,t.jsx)(i.code,{children:"AUTH_AZURE_B2C_SCOPE"})," environment variable. Refer to Azure tutorials to learn ",(0,t.jsx)(i.a,{href:"https://learn.microsoft.com/en-us/azure/active-directory-b2c/configure-authentication-sample-spa-app?tabs=app-reg-ga#step-22-configure-scopes",children:"how to configure scopes"}),"."]}),"\n",(0,t.jsxs)(i.li,{children:["Configure ",(0,t.jsx)(i.strong,{children:"API Permissions"}),": To call a protected web API from an application, you need to grant your application permissions to the API. In ",(0,t.jsx)(i.strong,{children:"App registrations/App registration name/Manage/API Permissions"})," section, add a Delegated permission type for the custom scope you have created in the previous step and ",(0,t.jsx)(i.a,{href:"https://learn.microsoft.com/en-us/entra/identity-platform/scopes-oidc#openid-connect-scopes",children:"OpenID scopes"})," ",(0,t.jsx)(i.code,{children:"openid"}),", ",(0,t.jsx)(i.code,{children:"profile"}),", ",(0,t.jsx)(i.code,{children:"email"}),", and ",(0,t.jsx)(i.code,{children:"offline_access"}),". Refer to ",(0,t.jsx)(i.a,{href:"https://learn.microsoft.com/en-us/azure/active-directory-b2c/add-web-api-application#grant-permissions",children:"Azure documentation"})," for more details."]}),"\n",(0,t.jsxs)(i.li,{children:["Create a ",(0,t.jsx)(i.strong,{children:"User Flow"}),":  A business logic that users follow to gain access to your application. Refer to ",(0,t.jsx)(i.a,{href:"https://learn.microsoft.com/en-us/azure/active-directory-b2c/tutorial-create-user-flows?pivots=b2c-user-flow",children:"Azure tutorials"})," to learn how to do this. Save the ",(0,t.jsx)(i.code,{children:"USER_FLOW_NAME"}),"- you will need it to configure DIAL Chat ",(0,t.jsx)(i.code,{children:"AUTH_AZURE_B2C_USER_FLOW"})," environment variable.","\n",(0,t.jsxs)(i.ul,{children:["\n",(0,t.jsxs)(i.li,{children:["DIAL Chat application uses ",(0,t.jsx)(i.a,{href:"https://next-auth.js.org/",children:"NextAuth.js"})," for authentication, which requires claims ",(0,t.jsx)(i.code,{children:"sub"}),", ",(0,t.jsx)(i.code,{children:"name"})," and ",(0,t.jsx)(i.code,{children:"emails"})," to be a part of JWT to authenticate users."]}),"\n"]}),"\n"]}),"\n",(0,t.jsxs)(i.li,{children:[(0,t.jsx)(i.strong,{children:"Enable role-based access"})," to applications, models and toolsets: A JWT provided by the identity provider configured in your User Flow must include a specific claim with user roles. Claim values will be used in ",(0,t.jsx)(i.a,{href:"#assignment-of-roles",children:"userRoles"})," settings in DIAL Core. The claim name itself is used in ",(0,t.jsx)(i.a,{href:"#dial-core-settings",children:"DIAL Core static settings"})," for ",(0,t.jsx)(i.code,{children:"rolePath"})," and as a value of the ",(0,t.jsx)(i.code,{children:"AUTH_AZURE_B2C_DIAL_ROLES_FIELD"})," DIAL Chat environment variable. In this tutorial, for clarity, we use the claim name ",(0,t.jsx)(i.code,{children:"roles"}),"."]}),"\n",(0,t.jsxs)(i.li,{children:[(0,t.jsx)(i.strong,{children:"Configure access for DIAL administrators"}),": To enable access for DIAL administrators, a claim for user roles in JWT provided by the identity provider configured in your User Flow must include a specific claim value for admin users. This value must match the ",(0,t.jsx)(i.code,{children:"target"})," value in ",(0,t.jsx)(i.code,{children:"access.admin.rules"})," settings in DIAL Core static settings. This claim value is also provided as a value for DIAL Chat environment variable ",(0,t.jsx)(i.code,{children:"AUTH_AZURE_B2C_ADMIN_ROLE_NAMES"}),". In this tutorial, for clarity, we use the claim name ",(0,t.jsx)(i.code,{children:"roles"})," and the value ",(0,t.jsx)(i.code,{children:"admin"})," to identify DIAL administrators."]}),"\n"]}),"\n",(0,t.jsx)(i.h3,{id:"configure-dial",children:"Configure DIAL"}),"\n",(0,t.jsx)(i.p,{children:"By configuring both DIAL Chat and DIAL Core with the necessary environment variables, you will enable them to work together seamlessly with Identity Provider for authentication and authorization purposes."}),"\n",(0,t.jsx)(i.h4,{id:"dial-chat-settings",children:"DIAL Chat Settings"}),"\n",(0,t.jsxs)(i.p,{children:["Add the following environment variables to DIAL Chat configuration. Refer to ",(0,t.jsx)(i.a,{href:"https://github.com/epam/ai-dial-chat/blob/development/apps/chat/README.md#environment-variables",children:"DIAL Chat"})," for more details."]}),"\n",(0,t.jsx)(i.p,{children:"Authentication variables:"}),"\n",(0,t.jsx)(i.pre,{children:(0,t.jsx)(i.code,{className:"language-yaml",children:"AUTH_AZURE_B2C_AUD : <azure_b2c_app_id>\nAUTH_AZURE_B2C_CLIENT_ID : <azure_b2c_client_id>\nAUTH_AZURE_B2C_CLIENT_SECRET : <azure_b2c_client_secret>\nAUTH_AZURE_B2C_DIAL_ROLES_FIELD : roles #claim with user roles from identity provider configured in the user flow\nAUTH_AZURE_B2C_ADMIN_ROLE_NAMES : admin #claim value from the roles claim used to identify admin users\nAUTH_AZURE_B2C_NAME : Azure B2C\nAUTH_AZURE_B2C_SCOPE : openid profile email offline_access <azure_b2c_tenant_id>.onmicrosoft.com/<azure_b2c_app_id>/Chat.Login\nAUTH_AZURE_B2C_TENANT_ID : <azure_b2c_tenant_id>\nAUTH_AZURE_B2C_USER_FLOW : USER_FLOW_NAME\n"})}),"\n",(0,t.jsxs)(i.blockquote,{children:["\n",(0,t.jsxs)(i.p,{children:[(0,t.jsx)(i.strong,{children:"Tip"}),": The application ",(0,t.jsx)(i.strong,{children:"scope"})," added above ",(0,t.jsx)(i.a,{href:"https://learn.microsoft.com/en-us/answers/questions/318741/graphapi-cannot-validate-access-token-signature",children:"is required to validate signature"})," of the access token."]}),"\n"]}),"\n",(0,t.jsx)(i.p,{children:"Additional variables:"}),"\n",(0,t.jsx)(i.pre,{children:(0,t.jsx)(i.code,{className:"language-yaml",children:"FEDERATED_LOGOUT_PROVIDERS : azure-ad-b2c #define value as azure-ad-b2c to enable logout\n"})}),"\n",(0,t.jsx)(i.h4,{id:"dial-core-settings",children:"DIAL Core Settings"}),"\n",(0,t.jsxs)(i.p,{children:["Add the following parameters to ",(0,t.jsx)(i.a,{href:"https://github.com/epam/ai-dial-core?tab=readme-ov-file#static-settings",children:"DIAL Core static settings"}),":"]}),"\n",(0,t.jsxs)(i.blockquote,{children:["\n",(0,t.jsxs)(i.p,{children:[(0,t.jsx)(i.strong,{children:"Note"}),": generate some random sting for ",(0,t.jsx)(i.code,{children:"loggingSalt"})," parameter, e.g. using ",(0,t.jsx)(i.code,{children:"pwgen -s 32 1"})]}),"\n"]}),"\n",(0,t.jsx)(i.pre,{children:(0,t.jsx)(i.code,{className:"language-yaml",children:"aidial.identityProviders.azureb2c.issuerPattern : ^https:\\/\\/<azure_b2c_tenant_id>\\.b2clogin\\.com.+$ #describes an issuer in a token\naidial.identityProviders.azureb2c.jwksUrl : <azure_b2c_tenant_id>.b2clogin.com/<azure_b2c_tenant_id>.onmicrosoft.com/<USER_FLOW_NAME>/discovery/v2.0/keys #used to validate a token\naidial.identityProviders.azureb2c.loggingKey : sub\naidial.identityProviders.azureb2c.loggingSalt : your-logging-salt\naidial.identityProviders.azureb2c.projectPath : aud\naidial.identityProviders.azureb2c.rolePath : roles #claim with user roles from identity provider configured in the user flow\naidial.identityProviders.azureb2c.userDisplayName : name #claim with the user name from identity provider configured in the user flow\n"})}),"\n",(0,t.jsxs)(i.p,{children:["To identify users with admin permissions, configure ",(0,t.jsx)(i.code,{children:"access.admin.rules"})," parameter in ",(0,t.jsx)(i.a,{href:"https://github.com/epam/ai-dial-core?tab=readme-ov-file#static-settings",children:"DIAL Core static settings"}),". In this tutorial, for clarity, we use claim ",(0,t.jsx)(i.code,{children:"roles"})," with value ",(0,t.jsx)(i.code,{children:"admin"})," to identify DIAL administrators. This claim must be a part of JWT from your identity provider. Refer to ",(0,t.jsx)(i.a,{href:"https://github.com/epam/ai-dial-core?tab=readme-ov-file#static-settings",children:"DIAL Core documentation"})," to learn how to configure ",(0,t.jsx)(i.code,{children:"access.admin.rules"}),"."]}),"\n",(0,t.jsx)(i.p,{children:"Example of DIAL Core configuration to identify DIAL administrators:"}),"\n",(0,t.jsx)(i.pre,{children:(0,t.jsx)(i.code,{className:"language-json",children:'{\n    "aidial": {\n        "access": {\n            "admin": {\n                "rules": [\n                    {\n                        "source": "roles",\n                        "function": "EQUAL",\n                        "targets": ["admin"]\n                    }\n                ]\n            }\n        }\n    }\n}\n'})}),"\n",(0,t.jsx)(i.h4,{id:"assignment-of-roles",children:"Assignment of Roles"}),"\n",(0,t.jsxs)(i.blockquote,{children:["\n",(0,t.jsxs)(i.p,{children:[(0,t.jsx)(i.strong,{children:"Note"}),": A User Flow must be defined to proceed with the assignment of roles to DIAL resources."]}),"\n"]}),"\n",(0,t.jsx)(i.p,{children:"Roles in DIAL are used to limit access to DIAL resources (applications, models, toolsets)."}),"\n",(0,t.jsxs)(i.p,{children:["To define roles, configure ",(0,t.jsx)(i.a,{href:"https://github.com/epam/ai-dial-core?tab=readme-ov-file#dynamic-settings",children:"DIAL Core dynamic settings"}),":"]}),"\n",(0,t.jsxs)(i.p,{children:["For the ",(0,t.jsx)(i.code,{children:"userRoles"})," settings, provide specific claim values provided in JWT by your identity provider. In this example, for clarity, we used claim ",(0,t.jsx)(i.code,{children:"roles"})," with value ",(0,t.jsx)(i.code,{children:"regular_user"})," to identify regular DIAL users. In the provided example, users with the ",(0,t.jsx)(i.code,{children:"regular_user"})," role have access to the ",(0,t.jsx)(i.code,{children:"chat-gpt-35-turbo"})," model."]}),"\n",(0,t.jsx)(i.pre,{children:(0,t.jsx)(i.code,{className:"language-json",children:'{\n  "models": {\n    "gpt-35-turbo": {\n      "type": "chat",\n      "endpoint": "http://localhost:5000/v1/openai/deployments/gpt-35-turbo/chat/completions",\n      "upstreams": [\n        {\n          "endpoint": "https://[REDACTED].openai.azure.com/openai/deployments/gpt-35-turbo/chat/completions",\n          "key": "[REDACTED]"\n        }\n      ],\n      "userRoles": [\n        "regular_user" #A specific claim value in the roles claim\n      ]\n    }\n  }\n}\n'})})]})}function u(e={}){const{wrapper:i}={...(0,r.a)(),...e.components};return i?(0,t.jsx)(i,{...e,children:(0,t.jsx)(d,{...e})}):d(e)}},11151:(e,i,n)=>{n.d(i,{Z:()=>a,a:()=>o});var t=n(67294);const r={},s=t.createContext(r);function o(e){const i=t.useContext(s);return t.useMemo((function(){return"function"==typeof e?e(i):{...i,...e}}),[i,e])}function a(e){let i;return i=e.disableParentContext?"function"==typeof e.components?e.components(r):e.components||r:o(e.components),t.createElement(s.Provider,{value:i},e.children)}}}]);